<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zero@Production ‚Äî Digital Product Ecosystem</title>
    <script>
    /* ZERO_DEMO_ROUTER v1 */
    (function(){
        try {
            const p = new URLSearchParams(window.location.search);
            const m = p.get("module");
            const r = p.get("role");
            if(m){
                let target = "";
                const map = {
                    "fabric": "fabric-dpp.html",
                    "chemicals": "chemicals-dyes-management.dpp.html",
                    "finishing": "finishing-dpp.html",
                    "garment": "GarmentDPP.html",
                    "yarn": "yarn-dpp.html",
                    "fibre": "fibre-dpp.html",
                    "it": "it-dpp.html",
                    "energy": "energy-dpp.html",
                    "retail": "retail-dpp.html",
                    "transport": "transport-dpp.html",
                    "delivery": "delivery-dpp.html",
                    "packaging": "packaging-dpp.html",
                    "office": "office-dpp.html"
                };
                if(map[m]) target = map[m];
                
                if(target){
                    if(r) target += "?role=" + r;
                    // Preserve facility if present
                    const f = p.get("facility");
                    if(f) target += "&facility=" + f;
                    
                    // Preserve order context
                    const order = p.get("order");
                    if(order) target += "&order=" + order;
                    const po = p.get("po");
                    if(po) target += "&po=" + po;
                    const style = p.get("style");
                    if(style) target += "&style=" + style;
                    
                    window.location.href = target;
                }
            }
        } catch(e) { console.warn("Router failed", e); }
    })();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
    :root {
        --zero-navy: #02154e;
        --zero-orange: #f9ba00;
        --zero-green: #005530;
        --zero-red: #D51635;
        --zero-white: #ffffff;
        --zero-black: #1a1a1a;
        --zero-gray-dark: #666666;
        --zero-gray-light: #e0e0e0;
        --zero-gray-bg: #fafafa;
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
        background: var(--zero-white);
        color: var(--zero-black);
        line-height: 1.6;
        padding-top: 4px;
    }
    
    .zero-color-bar {
        height: 4px;
        width: 100%;
        background: linear-gradient(90deg, 
            var(--zero-green) 0%, var(--zero-green) 25%, 
            var(--zero-red) 25%, var(--zero-red) 50%, 
            var(--zero-navy) 50%, var(--zero-navy) 75%, 
            var(--zero-orange) 75%, var(--zero-orange) 100%);
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
    }
    
    .app-header {
        background: var(--zero-white);
        color: var(--zero-navy);
        padding: 2rem;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        border-bottom: 1px solid var(--zero-gray-light);
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
    }
    
    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 1600px;
        margin: 0 auto;
    }
    
    .title {
        font-size: 1.5rem;
        font-weight: 300;
        color: var(--zero-navy);
    }
    
    .title-at { color: var(--zero-orange); }
    
    .hero {
        background: linear-gradient(135deg, rgba(2,21,78,0.05) 0%, rgba(255,255,255,1) 100%);
        padding: 4rem 2rem;
        text-align: center;
    }
    
    .hero-subtitle {
        font-size: 1.1rem;
        color: var(--zero-navy);
        font-weight: 300;
    }
    
    .container {
        max-width: 1600px;
        margin: 0 auto;
        padding: 4rem 2rem;
    }
    
    .product-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 2rem;
        margin-bottom: 4rem;
    }
    
    .product-card {
        background: var(--zero-white);
        border: 1px solid var(--zero-gray-light);
        border-radius: 8px;
        padding: 2rem;
        position: relative;
        transition: all 0.3s ease;
        cursor: pointer;
    }
    
    .product-card::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--zero-orange);
        transform: scaleX(0);
        transition: transform 0.3s ease;
    }
    
    .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    }
    
    .product-card:hover::after { transform: scaleX(1); }
    
    .product-logo {
        position: absolute;
        top: 15px;
        right: 15px;
        width: 50px;
        height: 50px;
        background: rgba(2,21,78,0.1);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        color: var(--zero-navy);
        opacity: 0.8;
    }
    
    .product-card:hover .product-logo { opacity: 1; }
    
    .product-title {
        font-size: 1.3rem;
        font-weight: 400;
        color: var(--zero-navy);
        margin-bottom: 1rem;
    }
    
    .product-at { color: var(--zero-orange); }
    
    .product-description {
        color: var(--zero-gray-dark);
        margin-bottom: 2rem;
        min-height: 3em;
        font-size: 0.95rem;
    }
    
    .action-btn {
        padding: 0.5rem 1.25rem;
        background: var(--zero-navy);
        color: var(--zero-white);
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-family: inherit;
        font-size: 0.85rem;
        font-weight: 500;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
    }
    
    .action-btn:hover {
        background: var(--zero-orange);
        color: var(--zero-navy);
    }
    
    .features-section { margin: 4rem 0; }
    
    .features-title {
        font-size: 1.3rem;
        color: var(--zero-navy);
        margin-bottom: 2rem;
    }
    
    .features-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 2rem;
    }
    
    .feature-card {
        background: var(--zero-gray-bg);
        border: 1px solid var(--zero-gray-light);
        border-radius: 6px;
        padding: 2rem;
        text-align: center;
    }
    
    .feature-value {
        font-size: 1.8rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
    }
    
    .feature-value.green { color: var(--zero-green); }
    .feature-value.orange { color: var(--zero-orange); }
    
    .feature-label {
        font-size: 0.85rem;
        color: var(--zero-gray-dark);
    }

    /* EXECUTIVE PERSONA CARDS */
    .persona-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1.5rem;
        margin-bottom: 3rem;
    }
    @media (max-width: 1024px) { .persona-grid { grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 768px) {
        .persona-grid {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 1rem;
        }
        .persona-card { min-width: 280px; scroll-snap-align: start; }
    }

    .persona-card {
        background: var(--zero-white);
        border: 1px solid var(--zero-gray-light);
        border-top-width: 4px;
        border-top-style: solid;
        border-radius: 8px;
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        cursor: pointer;
        min-height: 220px;
    }
    .persona-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    }
    
    .card-ceo { border-top-color: var(--zero-navy); }
    .card-cfo { border-top-color: var(--zero-orange); }
    .card-cto { border-top-color: var(--zero-green); }
    .card-md { border-top-color: var(--zero-gray-dark); }

    .p-title {
        font-size: 0.85rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: var(--zero-gray-dark);
        margin-bottom: 0.5rem;
    }
    .p-metric {
        font-size: 2rem;
        font-weight: 700;
        color: var(--zero-navy);
        line-height: 1.2;
        margin-bottom: 0.25rem;
    }
    .p-label {
        font-size: 0.9rem;
        color: var(--zero-gray-dark);
        margin-bottom: 1rem;
    }
    .p-sub {
        font-size: 0.9rem;
        font-weight: 500;
        margin-bottom: 0.5rem;
        color: var(--zero-navy);
    }
    .p-badge {
        display: inline-block;
        background: var(--zero-gray-bg);
        border: 1px solid var(--zero-gray-light);
        color: var(--zero-gray-dark);
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.75rem;
        margin-top: auto;
        margin-bottom: 1rem;
    }
    .p-cta {
        font-size: 0.85rem;
        font-weight: 600;
        text-align: right;
        color: var(--zero-navy);
    }
    @media print {
        @page { size: A4; margin: 0; }
        body * { visibility: hidden; }
        #zeroPrintRoot, #zeroPrintRoot * { visibility: visible; }
        #zeroPrintRoot {
            display: block !important;
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            background: white;
            color: black;
            font-family: 'Helvetica Neue', Arial, sans-serif;
        }
        .print-page {
            width: 210mm;
            min-height: 297mm;
            padding: 20mm;
            page-break-after: always;
            position: relative;
            box-sizing: border-box;
        }
        .print-page:last-child { page-break-after: auto; }
        .print-h1 { font-size: 24pt; color: #02154e; margin-bottom: 10mm; font-weight: bold; }
        .print-h2 { font-size: 18pt; color: #02154e; border-bottom: 2px solid #02154e; padding-bottom: 2mm; margin-bottom: 10mm; }
        .print-sub { font-size: 11pt; color: #444; margin-bottom: 5mm; line-height: 1.4; }
        .print-kpis { display: flex; gap: 10mm; margin-bottom: 10mm; }
        .print-kpi { flex: 1; border: 1px solid #ddd; padding: 5mm; border-radius: 4px; background: #fafafa; }
        .print-kpi.red { border-left: 5px solid #D51635; }
        .print-kpi.orange { border-left: 5px solid #f9ba00; }
        .print-kpi .k { font-size: 9pt; color: #666; margin-bottom: 2mm; text-transform: uppercase; }
        .print-kpi .v { font-size: 20pt; font-weight: bold; color: #02154e; }
        .print-bullets { margin-left: 5mm; margin-bottom: 10mm; }
        .print-bullets li { margin-bottom: 3mm; font-size: 11pt; }
        .print-foot {
            position: absolute;
            bottom: 15mm;
            left: 20mm;
            right: 20mm;
            font-size: 8pt;
            color: #999;
            border-top: 1px solid #eee;
            padding-top: 3mm;
            text-align: center;
        }
    }
/* ZERO_SALES_FLOW v1 */
.zero-btn{border:0;border-radius:10px;padding:10px 14px;font-weight:800;background:#f9ba00;color:#02154e;cursor:pointer;}
.zero-btn:hover{filter:brightness(0.97);}
.zero-focus{outline:3px solid #f9ba00; outline-offset:4px; border-radius:12px;}
.zero-cta{margin:18px 0 26px;padding:16px;border-radius:12px;background:#02154e;color:#fff;}
.zero-cta a{color:#f9ba00;font-weight:900;text-decoration:none;}
</style>
</head>
<body>
    <div class="zero-color-bar"></div>
    <!-- Hidden Print Container -->
    <div id="zeroPrintRoot" style="display:none;"></div>


<header class="app-header">
    <div class="header-content">
        <div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
            <div style="display: flex; align-items: center;">
                <img src="assets/img/plogo.svg" alt="Zero Logo" style="height: 80px; margin-right: 15px;">
                <div class="title">Zero@Production <span class="title-at">Ecosystem</span> ‚Äî Digital Product Passport by Zero<span class="title-at">@</span>Ecosystem</div>
            </div>
        </div>
    </div>
</header>

<div class="hero">
    <h1 style="font-weight: 300; margin-bottom: 1rem; color: var(--zero-navy);">Zero@Production</h1>
    <div class="hero-subtitle">Sustainable production with global standards. Exporting to 30+ countries with Ring, Compact & Open-End technologies.</div>
</div>

<!-- ZERO: SALES DEMO BAR -->
<section class="container" style="padding-top:0; padding-bottom:2rem;">
    <div class="zero-cta" style="display:flex; flex-wrap:wrap; gap:20px; justify-content:space-between; align-items:center; background:#02154e; color:white; box-shadow:0 10px 30px rgba(2,21,78,0.15);">
        <div style="font-size:1.1rem; font-weight:300;">
            <span style="font-weight:700; color:#f9ba00;">SALES DEMO MODE:</span> Choose persona to auto-launch story.
        </div>
        <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <button onclick="window.location.href='/?module=fabric&role=ceo&nocache='+Date.now()" class="zero-btn" style="background:#fff; color:#02154e;">Start CEO (Fabric)</button>
            <button onclick="window.location.href='/?module=chemicals&role=cfo&nocache='+Date.now()" class="zero-btn">Start CFO (Chemicals)</button>
            <button onclick="window.location.href='/?module=fabric&role=cto&nocache='+Date.now()" class="zero-btn" style="background:#fff; color:#02154e;">Start CTO (Fabric)</button>
            <button onclick="window.location.href='/?module=chemicals&role=md&nocache='+Date.now()" class="zero-btn" style="background:#fff; color:#02154e;">Start MD (Chemicals)</button>
            <button onclick="window.location.href='/?module=finishing&role=cfo&nocache='+Date.now()" class="zero-btn">Start CFO (Finishing)</button>
        </div>
    </div>
</section>

<main class="container">
    <!-- Executive Persona Cards -->
        <section id="executive-personas">
            <div style="margin-bottom: 1.5rem; display:flex; justify-content:space-between; align-items:flex-end;">
                <h2 style="font-size: 1.5rem; color: var(--zero-navy); font-weight: 300;">Executive Decision Lenses</h2>
                <div style="font-size:0.85rem; color:var(--zero-gray-dark); display:flex; gap:15px; align-items:center;">
                    <span>Same data, different executive lens</span>
                    <button onclick="exportExecutivePdfPrint()" style="background:#02154e; color:white; border:none; padding:8px 16px; border-radius:4px; font-size:0.85rem; cursor:pointer; font-weight:600; display:flex; align-items:center; gap:6px;">
                        <span>üìÑ</span> Export Executive PDF
                    </button>
                </div>
            </div>
        
        <div class="persona-grid">
            <!-- 1. CEO -->
            <div class="persona-card card-ceo">
                <div class="p-title">CEO ‚Äî Strategic Risk</div>
                <div class="p-metric" id="ceo-risk">‚Äî</div>
                <div class="p-label">Avg. Risk Exposure</div>
                <div class="p-sub" id="ceo-ratio">Premium/Risk: ‚Äî</div>
                <div class="p-badge">Brand & compliance exposure overview</div>
                <div class="p-cta">Enterprise Decision Layer</div>
            </div>

            <!-- 2. CFO -->
            <div class="persona-card card-cfo" onclick="openCfoModal()">
                <div class="p-title">CFO ‚Äî Financial Impact</div>
                <div class="p-metric" id="cfo-impact">‚Äî</div>
                <div class="p-label">Est. Financial Exposure</div>
                <div class="p-sub" id="cfo-volatility">Volatility: Med</div>
                <div class="p-badge">Financial exposure & cost delta</div>
                <div class="p-cta">‚Ç¨ Impact Ready</div>
            </div>

            <!-- 3. CTO -->
            <div class="persona-card card-cto">
                <div class="p-title">CTO ‚Äî Data & Integration</div>
                <div class="p-metric" id="cto-points">‚Äî</div>
                <div class="p-label">Data Points (Live)</div>
                <div class="p-sub" style="color:var(--zero-green);">Offline-Safe: Active</div>
                <div class="p-badge">ML-Ready / Decision-grade data</div>
                <div class="p-cta">ML-Ready / API-Ready</div>
            </div>

            <!-- 4. MD / COO -->
            <div class="persona-card card-md">
                <div class="p-title">MD / COO ‚Äî Operations</div>
                <div class="p-metric" id="md-high-risk">‚Äî</div>
                <div class="p-label">High-Risk Items</div>
                <div class="p-sub" id="md-split">Tech/Stable: ‚Äî</div>
                <div class="p-badge">Operational Control</div>
                <div class="p-cta">Operational Control</div>
            </div>
        </div>
    </section>

    <div class="product-grid">
        <!-- 1. Fibre -->
        <div class="product-card" onclick="window.location.href='fibre-dpp.html'">
            <div class="product-logo"><i class="fa-solid fa-seedling"></i></div>
            <div class="product-title">Fibre<span class="product-at"> </span>DPP</div>
            <div class="product-description">
                Raw materials and fiber production ‚Äî Yarn manufacturing
            </div>
            <a href="fibre-dpp.html" class="action-btn">View Module</a>
        </div>

        <!-- 2. Yarn -->
        <div class="product-card" onclick="window.location.href='yarn-dpp.html'">
            <div class="product-logo"><i class="fa-solid fa-layer-group"></i></div>
            <div class="product-title">Yarn<span class="product-at"> </span>DPP</div>
            <div class="product-description">
                Yarn production tracking ‚Äî Sustainability & Quality Metrics
            </div>
            <a href="yarn-dpp.html" class="action-btn">View Module</a>
        </div>

        <!-- 3. Fabric -->
        <div class="product-card" onclick="window.location.href='fabric-dpp.html'">
            <div class="product-logo"><i class="fa-solid fa-scroll"></i></div>
            <div class="product-title">Fabric<span class="product-at"> </span>DPP</div>
            <div class="product-description">
                Fabric production and quality control ‚Äî Weaving and knitting
            </div>
            <a href="fabric-dpp.html" class="action-btn">View Module</a>
        </div>

        <!-- 4. Chemicals & Dye -->
        <div class="product-card" onclick="window.location.href='chemicals-dyes-management.dpp.html'">
            <div class="product-logo"><i class="fa-solid fa-flask"></i></div>
            <div class="product-title">Chemicals<span class="product-at"> & </span>Dye</div>
            <div class="product-description">
                Chemical processing and dyeing ‚Äî Yarn stage orders tracking
            </div>
            <a href="chemicals-dyes-management.dpp.html" class="action-btn">View Module</a>
        </div>

        <!-- 5. Finishing -->
        <div class="product-card" onclick="window.location.href='finishing-dpp.html'">
            <div class="product-logo"><i class="fa-solid fa-wand-magic-sparkles"></i></div>
            <div class="product-title">Finishing<span class="product-at"> </span>DPP</div>
            <div class="product-description">
                Treatment and finishing processes ‚Äî Quality enhancement
            </div>
            <a href="finishing-dpp.html" class="action-btn">View Module</a>
        </div>

        <!-- Rest -->
        <div class="product-card" onclick="window.location.href='GarmentDPP.html'">
            <div class="product-logo"><i class="fa-solid fa-shirt"></i></div>
            <div class="product-title">Garment<span class="product-at"> </span>DPP</div>
            <div class="product-description">
                Garment assembly and production ‚Äî Cut, make, trim operations
            </div>
            <a href="GarmentDPP.html" class="action-btn">View Module</a>
        </div>

        <div class="product-card" onclick="window.location.href='packaging-dpp.html'">
            <div class="product-logo"><i class="fa-solid fa-box-open"></i></div>
            <div class="product-title">Packaging<span class="product-at"></span></div>
            <div class="product-description">
                Packaging management ‚Äî Ready to pack orders
            </div>
            <a href="packaging-dpp.html" class="action-btn">View Module</a>
        </div>

        <div class="product-card" onclick="window.location.href='delivery-dpp.html'">
            <div class="product-logo"><i class="fa-solid fa-truck-fast"></i></div>
            <div class="product-title">Order<span class="product-at"> </span>Delivery</div>
            <div class="product-description">
                Delivery management ‚Äî Completed and delivered orders
            </div>
            <a href="delivery-dpp.html" class="action-btn">View Module</a>
        </div>

        <div class="product-card" onclick="window.location.href='transport-dpp.html'">
            <div class="product-logo"><i class="fa-solid fa-bus"></i></div>
            <div class="product-title">Employee<span class="product-at"> </span>Transport</div>
            <div class="product-description">
                Logistics and transport ‚Äî Orders in transit
            </div>
            <a href="transport-dpp.html" class="action-btn">View Module</a>
        </div>

        <!-- Energy -->
        <div class="product-card" onclick="window.location.href='energy-dpp.html'">
            <div class="product-logo"><i class="fa-solid fa-bolt"></i></div>
            <div class="product-title">Energy<span class="product-at"> & </span>Utilities</div>
            <div class="product-description">
                Energy consumption tracking ‚Äî Sustainability & Resources
            </div>
            <a href="energy-dpp.html" class="action-btn">View Module</a>
        </div>

        <!-- Office -->
        <div class="product-card" onclick="window.location.href='office-dpp.html'">
            <div class="product-logo"><i class="fa-solid fa-building"></i></div>
            <div class="product-title">Office<span class="product-at"> </span>DPP</div>
            <div class="product-description">
                Corporate office operations ‚Äî Administrative tracking
            </div>
            <a href="office-dpp.html" class="action-btn">View Module</a>
        </div>

        <!-- Retail -->
        <div class="product-card" onclick="window.location.href='retail-dpp.html'">
            <div class="product-logo"><i class="fa-solid fa-store"></i></div>
            <div class="product-title">Retail<span class="product-at"> & </span>Distribution</div>
            <div class="product-description">
                Retail management and distribution ‚Äî End-consumer tracking
            </div>
            <a href="retail-dpp.html" class="action-btn">View Module</a>
        </div>

        <!-- IT -->
        <div class="product-card" onclick="window.location.href='it-dpp.html'">
            <div class="product-logo"><i class="fa-solid fa-laptop-code"></i></div>
            <div class="product-title">IT<span class="product-at"> </span>DPP</div>
            <div class="product-description">
                Information Technology ‚Äî Systems & Infrastructure
            </div>
            <a href="it-dpp.html" class="action-btn">View Module</a>
        </div>
    </div>

    <div class="features-section">
        <h3 class="features-title">üìä System Overview</h3>
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-value green">50</div>
                <div class="feature-label">Total Orders</div>
            </div>
            <div class="feature-card">
                <div class="feature-value orange">610,335</div>
                <div class="feature-label">Total Pieces</div>
            </div>
            <div class="feature-card">
                <div class="feature-value green">7</div>
                <div class="feature-label">Countries</div>
            </div>
            <div class="feature-card">
                <div class="feature-value orange">8</div>
                <div class="feature-label">Active Modules</div>
            </div>
        </div>
    </div>
</main>

<script>
/* ZERO: Executive Persona Data Injection */
(async function(){
    try {
        // Fetch Fibre & Fabric Data
        const [fibRes, fabRes] = await Promise.all([
            fetch('assets/data/fibre-cards.json'),
            fetch('assets/data/fabric-cards.json')
        ]);
        
        const fibData = await fibRes.json();
        const fabData = await fabRes.json();
        
        const fibres = fibData.cards || [];
        const fabrics = fabData.cards || [];
        const allItems = [...fibres, ...fabrics];
        
        // --- 1. CEO Logic ---
        // Risk Exposure: Avg risk score
        let totalRisk = 0;
        let count = 0;
        let premiumCount = 0;
        let highRiskCount = 0;
        
        const isPremium = (txt) => /(turkish|african|giza|supima)/i.test(txt);
        const isHighRisk = (item) => {
            const r = item.risk_score ?? item.risk ?? 0;
            const g = (item.group||"").toLowerCase();
            return r >= 40 || g === "technical";
        };

        allItems.forEach(item => {
            const r = item.risk_score ?? item.risk ?? 0;
            totalRisk += r;
            count++;
            
            const txt = (item.name||"") + " " + (item.composition||"");
            if(isPremium(txt)) premiumCount++;
            if(isHighRisk(item)) highRiskCount++;
        });

        const avgRisk = count ? Math.round(totalRisk / count) : 0;
        const ratio = highRiskCount ? (premiumCount / highRiskCount).toFixed(1) : premiumCount;
        
        document.getElementById('ceo-risk').textContent = avgRisk + "/100";
        document.getElementById('ceo-ratio').textContent = `Premium/Risk: ${ratio}x`;

        // --- 2. CFO Logic ---
        // Mock Financial Impact: sum(CO2 * 120) as Proxy for ‚Ç¨ Risk
        let totalCo2 = 0;
        allItems.forEach(item => {
            const co2 = item.co2_kgkg ?? item.co2_kg_per_kg ?? 0;
            totalCo2 += co2;
        });
        const estEur = Math.round(totalCo2 * 120); 
        const kEur = (estEur / 1000).toFixed(1);
        
        document.getElementById('cfo-impact').textContent = `‚Ç¨${kEur}k`;
        // Volatility signal based on avg risk
        const vol = avgRisk > 35 ? "High" : (avgRisk > 25 ? "Med" : "Low");
        document.getElementById('cfo-volatility').textContent = `Volatility: ${vol}`;

        // --- 3. CTO Logic ---
        // Data points: Total items * fields per item (approx 12)
        const dataPoints = count * 12; 
        document.getElementById('cto-points').textContent = dataPoints.toLocaleString();

        // --- 4. MD / COO Logic ---
        // High risk count already calc
        // Tech/Stable split
        const techCount = allItems.filter(i => (i.group||"").toLowerCase() === "technical").length;
        const stableCount = count - techCount;
        const split = stableCount ? (techCount / stableCount).toFixed(2) : techCount;

        document.getElementById('md-high-risk').textContent = highRiskCount;
        document.getElementById('md-split').textContent = `Tech/Stable: ${split}`;

    } catch(e) {
        console.warn("Executive Data Load Failed", e);
        document.getElementById('ceo-risk').textContent = "‚Äî";
    }
})();
</script>
<!-- CFO SHOCK MODAL -->
<div id="cfoModal" class="cfo-modal-overlay" style="display:none;">
    <div class="cfo-modal-panel">
        <div class="cfo-modal-header">
            <h3>Financial Exposure Snapshot</h3>
            <button onclick="closeCfoModal()" class="cfo-close-btn">&times;</button>
        </div>
        <div class="cfo-modal-body">
            <div class="cfo-shock-row">
                <div class="cfo-shock-value-box">
                    <div class="cfo-label">Unmitigated Annual Exposure</div>
                    <div class="cfo-big-number" id="cfoShockExposure">‚Äî</div>
                    <div class="cfo-sub-text">If current conditions persist 12 months</div>
                </div>
                <div class="cfo-shock-stats">
                    <div class="stat-row">
                        <span>High-Risk Items (Risk ‚â• 40)</span>
                        <span class="stat-val" id="cfoRiskCount">‚Äî</span>
                    </div>
                    <div class="stat-row">
                        <span>Avg. Monthly Cost Proxy</span>
                        <span class="stat-val" id="cfoAvgCost">‚Äî</span>
                    </div>
                    <div class="stat-row">
                        <span>Volatility Multiplier</span>
                        <span class="stat-val">1.2x (Market)</span>
                    </div>
                </div>
            </div>
            
            <div class="cfo-narrative-box">
                <h4>‚ö†Ô∏è Executive Warning</h4>
                <p>
                    Financial risk is currently decoupled from sustainability rhetoric. 
                    Based on live volatility data, <span id="cfoRiskItemCountText">X</span> items are flagged as 
                    <strong>high-exposure assets</strong>. The "Do Nothing" cost scenario projects a 
                    significant P&L impact.
                </p>
                <div class="cfo-calc-note">
                    <strong>Calculation Logic:</strong> Sum(High-Risk Items √ó Monthly Cost Proxy √ó 12). 
                    Cost Proxy derived from CO‚ÇÇ intensity √ó ‚Ç¨120/t (Carbon Adjusted Price).
                </div>
            </div>

            <div class="cfo-actions">
                <button class="cfo-btn-primary" onclick="closeCfoModal()">Acknowledge Risk</button>
                <button class="cfo-btn-secondary">Export P&L Impact</button>
            </div>
        </div>
    </div>
</div>

<style>
/* CFO MODAL STYLES */
.cfo-modal-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(2, 21, 78, 0.6); backdrop-filter: blur(4px);
    z-index: 9999; display: flex; align-items: center; justify-content: center;
}
.cfo-modal-panel {
    background: #fff; width: 90%; max-width: 650px;
    border-radius: 8px; box-shadow: 0 20px 50px rgba(0,0,0,0.3);
    overflow: hidden; font-family: 'Inter', sans-serif;
    animation: cfoSlideUp 0.3s ease-out;
}
@keyframes cfoSlideUp { from {transform: translateY(20px); opacity:0;} to {transform: translateY(0); opacity:1;} }

.cfo-modal-header {
    background: #02154e; color: #fff; padding: 1.5rem 2rem;
    display: flex; justify-content: space-between; align-items: center;
}
.cfo-modal-header h3 { margin: 0; font-weight: 400; font-size: 1.25rem; letter-spacing: 0.5px; }
.cfo-close-btn { background: none; border: none; color: #fff; font-size: 2rem; cursor: pointer; opacity: 0.7; }
.cfo-close-btn:hover { opacity: 1; }

.cfo-modal-body { padding: 2rem; }

.cfo-shock-row { display: flex; gap: 2rem; margin-bottom: 2rem; border-bottom: 1px solid #eee; padding-bottom: 2rem; }
@media(max-width: 600px) { .cfo-shock-row { flex-direction: column; gap: 1rem; } }

.cfo-shock-value-box { flex: 1; }
.cfo-label { text-transform: uppercase; font-size: 0.75rem; color: #666; font-weight: 700; letter-spacing: 1px; margin-bottom: 0.5rem; }
.cfo-big-number { font-size: 2.5rem; font-weight: 800; color: #D51635; line-height: 1.1; margin-bottom: 0.5rem; }
.cfo-sub-text { font-size: 0.85rem; color: #888; font-style: italic; }

.cfo-shock-stats { flex: 1; display: flex; flex-direction: column; gap: 0.75rem; justify-content: center; }
.stat-row { display: flex; justify-content: space-between; font-size: 0.9rem; color: #444; border-bottom: 1px solid #f5f5f5; padding-bottom: 4px; }
.stat-val { font-weight: 600; color: #02154e; }

.cfo-narrative-box { background: #f9f9f9; padding: 1.5rem; border-left: 4px solid #D51635; margin-bottom: 2rem; }
.cfo-narrative-box h4 { margin: 0 0 0.5rem 0; color: #D51635; font-size: 1rem; display: flex; align-items: center; gap: 8px; }
.cfo-narrative-box p { margin: 0; font-size: 0.95rem; line-height: 1.5; color: #333; }
.cfo-calc-note { margin-top: 1rem; font-size: 0.75rem; color: #888; border-top: 1px solid #e0e0e0; padding-top: 0.5rem; }

.cfo-actions { display: flex; gap: 1rem; justify-content: flex-end; }
.cfo-btn-primary { background: #02154e; color: #fff; border: none; padding: 0.75rem 1.5rem; border-radius: 4px; font-weight: 600; cursor: pointer; }
.cfo-btn-primary:hover { background: #032070; }
.cfo-btn-secondary { background: transparent; color: #02154e; border: 1px solid #02154e; padding: 0.75rem 1.5rem; border-radius: 4px; font-weight: 600; cursor: pointer; }
.cfo-btn-secondary:hover { background: #f0f4ff; }
</style>

<script>
/* ZERO: CFO SHOCK LOGIC */
let cfoDataLoaded = false;

function openCfoModal() {
    document.getElementById('cfoModal').style.display = 'flex';
    if(!cfoDataLoaded) {
        calculateCfoShock();
        cfoDataLoaded = true;
    }
}

function closeCfoModal() {
    document.getElementById('cfoModal').style.display = 'none';
}

async function calculateCfoShock() {
    try {
        const [fibRes, fabRes] = await Promise.all([
            fetch('assets/data/fibre-cards.json'),
            fetch('assets/data/fabric-cards.json')
        ]);
        const fibData = await fibRes.json();
        const fabData = await fabRes.json();
        const allItems = [...(fibData.cards||[]), ...(fabData.cards||[])];

        let highRiskCount = 0;
        let totalMonthlyCostProxy = 0;
        let totalExposure = 0;

        allItems.forEach(item => {
            const risk = item.risk_score ?? item.risk ?? 0;
            
            // "High Risk" definition for CFO View: Risk >= 40
            if(risk >= 40) {
                highRiskCount++;
                
                // Cost Proxy Logic:
                // If no real cost, use CO2 * 120 (Carbon Price Proxy)
                // Real monthly cost would be item.monthly_cost (if exists)
                // We use CO2 * 120 as a "Shadow Price" for exposure calculation
                const co2 = item.co2_kgkg ?? item.co2_kg_per_kg ?? 0;
                const costProxy = co2 * 120; // ‚Ç¨ per unit proxy
                
                // Annualized Exposure = CostProxy * 12
                // (Assuming 1 unit volume for simplicity if volume missing, or use volume if avail)
                // Since volume is missing, we treat this as "Unit Exposure" or assume standard lot
                // To make numbers realistic for a dashboard, we'll assume standard lot size of 1000 units
                // Or just keep it as "Unit Exposure" but that might be too small.
                // The prompt says "Estimated annual cost exposure".
                // Let's assume a multiplier for "Standard Batch" = 1000.
                
                const batchSize = 1000; 
                const monthlyExposure = costProxy * batchSize;
                totalExposure += (monthlyExposure * 12);
                totalMonthlyCostProxy += monthlyExposure;
            }
        });

        // Update DOM
        const expM = (totalExposure / 1000000).toFixed(1);
        document.getElementById('cfoShockExposure').textContent = `‚Ç¨${expM}M`;
        document.getElementById('cfoRiskCount').textContent = highRiskCount;
        
        const avgMonthly = highRiskCount ? Math.round(totalMonthlyCostProxy / highRiskCount) : 0;
        document.getElementById('cfoAvgCost').textContent = `‚Ç¨${(avgMonthly/1000).toFixed(1)}k`;
        
        document.getElementById('cfoRiskItemCountText').textContent = highRiskCount;

    } catch(e) {
        console.warn("CFO Calc Failed", e);
        document.getElementById('cfoShockExposure').textContent = "Err";
    }
}

// Close on outside click
window.onclick = function(event) {
    const modal = document.getElementById('cfoModal');
    if (event.target == modal) {
        closeCfoModal();
    }
}

/* ZERO_PRINT_EXPORT v1 ‚Äî no external libs */ 
async function exportExecutivePdfPrint(){ 
   const root = document.getElementById("zeroPrintRoot"); 
   if(!root) return; 
 
   // helpers 
   const fmtEUR = (n)=> { 
     const x = Math.round(Number(n||0)); 
     return "‚Ç¨" + x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","); 
   }; 
   const pct = (n)=> (Math.round((Number(n)||0)*10)/10).toFixed(1) + "%"; 
 
   // load data (existing files) 
   const [fibRes, fabRes] = await Promise.all([ 
     fetch("assets/data/fibre-cards.json", {cache:"no-store"}).then(r=>r.json()).catch(()=>[]), 
     fetch("assets/data/fabric-cards.json", {cache:"no-store"}).then(r=>r.json()).catch(()=>[]) 
   ]); 
   const all = [].concat(fibRes.cards||[], fabRes.cards||[]); 
 
   // calc 
   const riskVal = (c)=> Number((c.risk_score ?? c.risk) || 0); 
   const isHigh = (c)=> riskVal(c) >= 40; 
   const hi = all.filter(isHigh); 
   const premium = all.filter(c => { 
     const s = ((c.name||"") + " " + (c.composition||"")).toLowerCase(); 
     return /(turkish|african|giza|supima)/i.test(s); 
   }); 
 
   const total = all.length || 1; 
   const hiPct = (hi.length / total) * 100; 
   const premPct = (premium.length / total) * 100; 
 
   // CFO exposure: use same proxy as current modal (keep consistent) 
   const co2kg = (c)=> Number(c.co2_kg_per_kg || c.co2_kgkg || 0); 
   const shadowPrice = 120;     // ‚Ç¨/t proxy factor basis you used 
   const batchKg = 1000;        // standardized batch 
   const avgMonthlyProxy = hi.length ? (hi.reduce((a,c)=>a + (co2kg(c)*shadowPrice),0) / hi.length) : 0; 
   const annualExposure = hi.reduce((a,c)=>a + (co2kg(c)*shadowPrice*batchKg*12),0); 
 
   // CTO completeness proxy 
   const completeness = Math.min(100, Math.round((all.filter(c=> (c.name && (c.group||c.category))).length / total) * 100)); 
 
   // MD split 
   const technical = all.filter(c=> String(c.group||"").toLowerCase()==="technical").length; 
   const stable = total - technical; 
 
   const today = new Date(); 
   const d = today.toISOString().slice(0,10); 
 
   // build pages 
   root.innerHTML = ` 
     <div class="print-page"> 
       <div class="print-h1">Zero@Production ‚Äî Executive Risk & Sustainability Snapshot</div> 
       <div class="print-sub">Decision-grade data. Same data, different executive lens.</div> 
       <div class="print-sub">Date: ${d}</div> 
       <div class="print-foot">ML-Ready ¬∑ Demo Data ¬∑ Zero@Ecosystem</div> 
     </div> 
 
     <div class="print-page"> 
       <div class="print-h2">CEO View ‚Äî Enterprise Exposure Overview</div> 
       <div class="print-kpis"> 
         <div class="print-kpi"><div class="k">Total items analyzed</div><div class="v">${total}</div></div> 
         <div class="print-kpi red"><div class="k">% High-Risk items</div><div class="v">${pct(hiPct)}</div></div> 
         <div class="print-kpi"><div class="k">Premium Origin ratio</div><div class="v">${pct(premPct)}</div></div> 
       </div> 
       <div class="print-sub"> 
         ${pct(hiPct)} of the current material portfolio shows elevated operational or compliance risk. 
         Premium origin materials represent ${pct(premPct)} of total coverage, creating both margin opportunity and concentration exposure. 
       </div> 
       <div class="print-foot">Same data, different executive lens.</div> 
     </div> 
 
     <div class="print-page"> 
       <div class="print-h2">CFO View ‚Äî Financial Exposure Snapshot</div> 
       <div class="print-kpis"> 
         <div class="print-kpi red"><div class="k">Estimated annual exposure (unmitigated)</div><div class="v">${fmtEUR(annualExposure)}</div></div> 
         <div class="print-kpi orange"><div class="k">High-risk items</div><div class="v">${hi.length}</div></div> 
         <div class="print-kpi"><div class="k">Avg monthly cost proxy</div><div class="v">${fmtEUR(avgMonthlyProxy*1000)}</div></div> 
       </div> 
       <div class="print-sub"> 
         If current conditions persist, estimated exposure exceeds <b>${fmtEUR(annualExposure)}</b> annually. 
         This is financial risk ‚Äî driven by cost volatility and unmitigated exposure ‚Äî not sustainability rhetoric. 
       </div> 
       <div class="print-foot">Based on shadow carbon pricing and standardized batch assumptions.</div> 
     </div> 
 
     <div class="print-page"> 
       <div class="print-h2">CTO / MD View ‚Äî Data & Operations</div> 
       <div class="print-kpis"> 
         <div class="print-kpi"><div class="k">Data completeness</div><div class="v">${completeness}%</div></div> 
         <div class="print-kpi"><div class="k">ML-Ready</div><div class="v">YES</div></div> 
         <div class="print-kpi"><div class="k">Technical vs Stable</div><div class="v">${technical} / ${stable}</div></div> 
       </div> 
       <ul class="print-bullets"> 
         <li>Offline-safe demo architecture (no CDN)</li> 
         <li>Coverage includes Fibre + Fabric decision lenses</li> 
         <li>High-risk concentration highlights decision window for mitigation</li> 
       </ul> 
       <div class="print-foot">Decision-grade data.</div> 
     </div> 
 
     <div class="print-page"> 
       <div class="print-h2">From Insight to Action</div> 
       <ul class="print-bullets"> 
         <li>Reduce exposure by addressing high-risk materials first</li> 
         <li>Improve sourcing strategy with premium/sustainable balance</li> 
         <li>Prepare for CSRD / CBAM reporting with decision-grade structure</li> 
       </ul> 
       <div class="print-sub" style="margin-top:8mm;"> 
         <b>Next Step:</b> Pilot Deployment (4‚Äì6 Weeks) 
       </div> 
       <div class="print-foot">ML-Ready ¬∑ Executive-ready ¬∑ Sales-ready</div> 
     </div> 
   `; 
 
   // show root only for print 
   root.style.display = "block"; 
 
   // print 
   setTimeout(()=>{ 
     window.print(); 
     // hide again after print dialog opens 
     setTimeout(()=>{ root.style.display="none"; }, 500); 
   }, 50); 
 }
</script>
<!-- PDF GENERATION LIBS -->
<script src="assets/libs/jspdf.umd.min.js"></script>
<script>
/* ZERO: EXECUTIVE PDF GENERATOR */
async function generateExecutivePDF() {
    // check lib
    if(!window.jspdf) {
        alert("System Notice: PDF Engine (jspdf) missing.\nPlease run: curl -L -o assets/libs/jspdf.umd.min.js https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js");
        return;
    }

    const btn = document.querySelector('button[onclick="generateExecutivePDF()"]');
    const oldText = btn.innerHTML;
    btn.innerHTML = "Generating...";
    btn.disabled = true;

    try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const width = doc.internal.pageSize.getWidth();
        const height = doc.internal.pageSize.getHeight();
        const margin = 20;

        // --- DATA FETCH & CALC ---
        const [fibRes, fabRes] = await Promise.all([
            fetch('assets/data/fibre-cards.json'),
            fetch('assets/data/fabric-cards.json')
        ]);
        const fibData = await fibRes.json();
        const fabData = await fabRes.json();
        const allItems = [...(fibData.cards||[]), ...(fabData.cards||[])];
        
        let count = 0;
        let riskCount = 0;
        let premiumCount = 0;
        let techCount = 0;
        let totalRiskScore = 0;
        let totalCo2 = 0;
        let cfoExposure = 0;

        allItems.forEach(i => {
            count++;
            const r = i.risk_score ?? i.risk ?? 0;
            const g = (i.group||"").toLowerCase();
            const txt = (i.name||"") + " " + (i.composition||"");
            
            totalRiskScore += r;
            totalCo2 += (i.co2_kgkg ?? i.co2_kg_per_kg ?? 0);

            if(r >= 40 || g==="technical") riskCount++;
            if(/(turkish|african|giza|supima)/i.test(txt)) premiumCount++;
            if(g==="technical") techCount++;

            if(r >= 40) {
                 const co2 = i.co2_kgkg ?? i.co2_kg_per_kg ?? 0;
                 // CFO Proxy: CO2 * 120 * 1000 units * 12 months
                 cfoExposure += (co2 * 120 * 1000 * 12);
            }
        });

        const avgRisk = count ? Math.round(totalRiskScore/count) : 0;
        const highRiskPct = count ? Math.round((riskCount/count)*100) : 0;
        const premiumPct = count ? Math.round((premiumCount/count)*100) : 0;
        const stablePct = count ? Math.round(((count-techCount)/count)*100) : 0;
        const techPct = 100 - stablePct;
        const cfoExpM = (cfoExposure/1000000).toFixed(1);
        const avgCo2Cost = riskCount ? Math.round((cfoExposure/12/riskCount)/1000) + "k" : "0"; // Avg monthly per item

        // --- PDF STYLING HELPERS ---
        const navy = "#02154e";
        const red = "#D51635";
        const gray = "#666666";
        
        const center = (txt, y, size=12, color=navy, font="helvetica", style="normal") => {
            doc.setFont(font, style);
            doc.setFontSize(size);
            doc.setTextColor(color);
            doc.text(txt, width/2, y, {align:"center"});
        };
        
        const left = (txt, y, size=11, color=navy, font="helvetica", style="normal") => {
            doc.setFont(font, style);
            doc.setFontSize(size);
            doc.setTextColor(color);
            doc.text(txt, margin, y);
        };

        const hr = (y) => {
            doc.setDrawColor(200, 200, 200);
            doc.line(margin, y, width-margin, y);
        };

        // --- PAGE 1: COVER ---
        doc.setFillColor(2, 21, 78); // Navy bg
        doc.rect(0, 0, width, height, "F");
        
        center("ZERO@PRODUCTION", height/2 - 20, 24, "#ffffff", "helvetica", "bold");
        center("EXECUTIVE RISK & SUSTAINABILITY SNAPSHOT", height/2, 14, "#cccccc");
        center("Decision-grade data. Same data, different executive lens.", height/2 + 10, 10, "#999999", "helvetica", "italic");
        
        doc.setFontSize(10);
        doc.setTextColor("#aaaaaa");
        doc.text(`Generated: ${new Date().toLocaleDateString()}`, width/2, height - 30, {align:"center"});
        doc.text("ML-Ready ¬∑ Demo Data ¬∑ Zero@Ecosystem", width/2, height - 20, {align:"center"});

        // --- PAGE 2: CEO VIEW (Risk) ---
        doc.addPage();
        left("CEO VIEW ‚Äî STRATEGIC RISK", 30, 16, navy, "helvetica", "bold");
        hr(35);

        left("ENTERPRISE EXPOSURE OVERVIEW", 50, 12, gray);
        
        // KPIs
        let y = 70;
        left(`Total Items Analyzed: ${count}`, y, 14, navy, "helvetica", "bold");
        left(`High-Risk Portfolio: ${highRiskPct}%`, y+10, 14, red, "helvetica", "bold");
        left(`Premium Origin Ratio: ${premiumPct}%`, y+20, 14, navy, "helvetica", "bold");

        // Narrative
        y = 110;
        doc.setFontSize(11);
        doc.setTextColor("#333");
        const narrative = `${highRiskPct}% of the current material portfolio shows elevated operational or compliance risk. Premium origin materials represent ${premiumPct}% of total volume, creating both margin opportunity and concentration exposure.`;
        const splitText = doc.splitTextToSize(narrative, width - (margin*2));
        doc.text(splitText, margin, y);

        // --- PAGE 3: CFO VIEW (Financial) ---
        doc.addPage();
        left("CFO VIEW ‚Äî FINANCIAL IMPACT", 30, 16, navy, "helvetica", "bold");
        hr(35);

        left("FINANCIAL EXPOSURE SNAPSHOT", 50, 12, gray);
        
        // Big Number
        center(`‚Ç¨${cfoExpM}M`, 90, 40, red, "helvetica", "bold");
        center("Estimated Annual Exposure", 105, 12, gray);

        // Breakdown
        y = 140;
        left("Breakdown:", margin, 12, navy, "helvetica", "bold");
        left(`‚Ä¢ High-Risk Item Count: ${riskCount}`, y+10, 11);
        left(`‚Ä¢ Avg. Monthly Cost Proxy: ‚Ç¨${avgCo2Cost} (per item)`, y+20, 11);
        left(`‚Ä¢ Volatility Multiplier: 1.2x (Market)`, y+30, 11);

        // Disclaimer
        doc.setFontSize(9);
        doc.setTextColor("#888");
        doc.text("Disclaimer: Based on shadow carbon pricing (‚Ç¨120/t) and standardized batch assumptions.", margin, height-20);

        // --- PAGE 4: CTO / MD VIEW ---
        doc.addPage();
        left("CTO / MD VIEW ‚Äî OPERATIONS", 30, 16, navy, "helvetica", "bold");
        hr(35);

        // CTO
        left("CTO: DATA & INTEGRATION", 50, 12, navy, "helvetica", "bold");
        left(`‚Ä¢ Data Completeness: ${(count*12).toLocaleString()} Points`, 65, 11);
        left(`‚Ä¢ ML-Ready: YES (Structured JSON)`, 75, 11);
        left(`‚Ä¢ Coverage: Fibre + Fabric Libraries`, 85, 11);
        
        // MD
        left("MD / COO: OPERATIONAL CONTROL", 110, 12, navy, "helvetica", "bold");
        left(`‚Ä¢ Technical vs Stable Split: ${techPct}% / ${stablePct}%`, 125, 11);
        left(`‚Ä¢ Supply Risk Hotspots: Technical Textiles, High-Carbon Logistics`, 135, 11);

        // --- PAGE 5: CALL TO ACTION ---
        doc.addPage();
        
        // Box
        doc.setFillColor(245, 247, 250);
        doc.roundedRect(margin, 40, width-(margin*2), 100, 3, 3, "F");
        
        center("FROM INSIGHT TO ACTION", 60, 16, navy, "helvetica", "bold");
        
        y = 80;
        left("‚Ä¢ Reduce Exposure: Switch high-risk technical fabrics to certified alts.", margin+10, 11, "#444");
        left("‚Ä¢ Improve Sourcing: Leverage Premium Origin contracts.", margin+10, y+10, 11, "#444");
        left("‚Ä¢ Compliance: Prepare for CSRD / CBAM reporting cycles.", margin+10, y+20, 11, "#444");

        // Button simulation
        doc.setFillColor(2, 21, 78);
        doc.roundedRect(width/2 - 60, 110, 120, 14, 2, 2, "F");
        center("Next Step: Pilot Deployment (4-6 Weeks)", 119, 10, "#ffffff", "helvetica", "bold");

        // Save
        const filename = `ZeroAtProduction_Executive_Snapshot_${new Date().toISOString().split('T')[0]}.pdf`;
        doc.save(filename);

    } catch(e) {
        console.error("PDF Gen Failed", e);
        alert("PDF Generation Failed: " + e.message);
    } finally {
        btn.innerHTML = oldText;
        btn.disabled = false;
    }
}
</script>
<script>
/* ZERO_PRINT_EXPORT v1 ‚Äî no external libs */
async function exportExecutivePdfPrint(){
  const root = document.getElementById("zeroPrintRoot");
  if(!root) return;

  // helpers
  const fmtEUR = (n)=> {
    const x = Math.round(Number(n||0));
    return "‚Ç¨" + x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
  };
  const pct = (n)=> (Math.round((Number(n)||0)*10)/10).toFixed(1) + "%";

  // load data (existing files)
  const [fibRes, fabRes] = await Promise.all([
    fetch("assets/data/fibre-cards.json", {cache:"no-store"}).then(r=>r.json()).catch(()=>[]),
    fetch("assets/data/fabric-cards.json", {cache:"no-store"}).then(r=>r.json()).catch(()=>[])
  ]);
  const all = [].concat(fibRes.cards||[], fabRes.cards||[]);

  // calc
  const riskVal = (c)=> Number((c.risk_score ?? c.risk) || 0);
  const isHigh = (c)=> riskVal(c) >= 40;
  const hi = all.filter(isHigh);
  const premium = all.filter(c => {
    const s = ((c.name||"") + " " + (c.composition||"")).toLowerCase();
    return /(turkish|african|giza|supima)/i.test(s);
  });

  const total = all.length || 1;
  const hiPct = (hi.length / total) * 100;
  const premPct = (premium.length / total) * 100;

  // CFO exposure: use same proxy as current modal (keep consistent)
  const co2kg = (c)=> Number(c.co2_kg_per_kg ?? c.co2_kgkg ?? 0);
  const shadowPrice = 120;     // ‚Ç¨/t proxy factor basis you used
  const batchKg = 1000;        // standardized batch
  const avgMonthlyProxy = hi.length ? (hi.reduce((a,c)=>a + (co2kg(c)*shadowPrice),0) / hi.length) : 0;
  const annualExposure = hi.reduce((a,c)=>a + (co2kg(c)*shadowPrice*batchKg*12),0);

  // CTO completeness proxy
  const completeness = Math.min(100, Math.round((all.filter(c=> (c.name && (c.group||c.category))).length / total) * 100));

  // MD split
  const technical = all.filter(c=> String(c.group||"").toLowerCase()==="technical").length;
  const stable = total - technical;

  const today = new Date();
  const d = today.toISOString().slice(0,10);

  // build pages
  root.innerHTML = `
    <div class="print-page">
      <div class="print-h1">Zero@Production ‚Äî Executive Risk & Sustainability Snapshot</div>
      <div class="print-sub">Decision-grade data. Same data, different executive lens.</div>
      <div class="print-sub">Date: ${d}</div>
      <div class="print-foot">ML-Ready ¬∑ Demo Data ¬∑ Zero@Ecosystem</div>
    </div>

    <div class="print-page">
      <div class="print-h2">CEO View ‚Äî Enterprise Exposure Overview</div>
      <div class="print-kpis">
        <div class="print-kpi"><div class="k">Total items analyzed</div><div class="v">${total}</div></div>
        <div class="print-kpi red"><div class="k">% High-Risk items</div><div class="v">${pct(hiPct)}</div></div>
        <div class="print-kpi"><div class="k">Premium Origin ratio</div><div class="v">${pct(premPct)}</div></div>
      </div>
      <div class="print-sub">
        ${pct(hiPct)} of the current material portfolio shows elevated operational or compliance risk.
        Premium origin materials represent ${pct(premPct)} of total coverage, creating both margin opportunity and concentration exposure.
      </div>
      <div class="print-foot">Same data, different executive lens.</div>
    </div>

    <div class="print-page">
      <div class="print-h2">CFO View ‚Äî Financial Exposure Snapshot</div>
      <div class="print-kpis">
        <div class="print-kpi red"><div class="k">Estimated annual exposure (unmitigated)</div><div class="v">${fmtEUR(annualExposure)}</div></div>
        <div class="print-kpi orange"><div class="k">High-risk items</div><div class="v">${hi.length}</div></div>
        <div class="print-kpi"><div class="k">Avg monthly cost proxy</div><div class="v">${fmtEUR(avgMonthlyProxy*1000)}</div></div>
      </div>
      <div class="print-sub">
        If current conditions persist, estimated exposure exceeds <b>${fmtEUR(annualExposure)}</b> annually.
        This is financial risk ‚Äî driven by cost volatility and unmitigated exposure ‚Äî not sustainability rhetoric.
      </div>
      <div class="print-foot">Based on shadow carbon pricing and standardized batch assumptions.</div>
    </div>

    <div class="print-page">
      <div class="print-h2">CTO / MD View ‚Äî Data & Operations</div>
      <div class="print-kpis">
        <div class="print-kpi"><div class="k">Data completeness</div><div class="v">${completeness}%</div></div>
        <div class="print-kpi"><div class="k">ML-Ready</div><div class="v">YES</div></div>
        <div class="print-kpi"><div class="k">Technical vs Stable</div><div class="v">${technical} / ${stable}</div></div>
      </div>
      <ul class="print-bullets">
        <li>Offline-safe demo architecture (no CDN)</li>
        <li>Coverage includes Fibre + Fabric decision lenses</li>
        <li>High-risk concentration highlights decision window for mitigation</li>
      </ul>
      <div class="print-foot">Decision-grade data.</div>
    </div>

    <div class="print-page">
      <div class="print-h2">From Insight to Action</div>
      <ul class="print-bullets">
        <li>Reduce exposure by addressing high-risk materials first</li>
        <li>Improve sourcing strategy with premium/sustainable balance</li>
        <li>Prepare for CSRD / CBAM reporting with decision-grade structure</li>
      </ul>
      <div class="print-sub" style="margin-top:8mm;">
        <b>Next Step:</b> Pilot Deployment (4‚Äì6 Weeks)
      </div>
      <div class="print-foot">ML-Ready ¬∑ Executive-ready ¬∑ Sales-ready</div>
    </div>
  `;

  // show root only for print
  root.style.display = "block";

  // print
  setTimeout(()=>{
    window.print();
    // hide again after print dialog opens
    setTimeout(()=>{ root.style.display="none"; }, 500);
  }, 50);
}
</script>
<script>
/* ZERO_SALES_FLOW_WIRING v1 */
(function(){
  const $ = (q)=>document.querySelector(q);
  const clearFocus = ()=>document.querySelectorAll(".zero-focus").forEach(el=>el.classList.remove("zero-focus"));
  const focusId = (id)=>{
    const el = document.getElementById(id);
    if(!el) return;
    clearFocus();
    el.classList.add("zero-focus");
    el.scrollIntoView({ behavior:"smooth", block:"start" });
  };

  const bar = document.getElementById("demoStart");
  if(!bar) return;

  bar.addEventListener("click", (e)=>{
    const btn = e.target && e.target.closest && e.target.closest("button[data-demo]");
    if(!btn) return;
    const role = (btn.getAttribute("data-demo")||"").toLowerCase();

    // Map roles to existing persona cards on index
    // NOTE: The IDs in the HTML are 'ceo-risk' etc inside the cards, but the cards themselves have classes like 'card-ceo'.
    // We need to target the card itself for the focus effect.
    // Let's check the HTML structure again. The user didn't give IDs to the cards in the previous turn, 
    // but the prompt assumes `focusId("lensCEO")`. 
    // I need to ADD IDs to the cards OR update the JS to find them by class.
    // The prompt says: "Map roles to existing persona cards on index"
    // And "if(role==='ceo') focusId('lensCEO');"
    // So I must ensure the cards have these IDs.
    
    // Let's add the IDs dynamically if they don't exist, or better, update the JS to find them by class and add ID if missing.
    // Actually, looking at the previous Read output:
    // <div class="persona-card card-ceo"> ... </div>
    // It does NOT have id="lensCEO".
    
    // I will modify this script to FIND the correct element and focus it, rather than relying on non-existent IDs.
    
    let target = null;
    if(role==="ceo") target = document.querySelector(".card-ceo");
    if(role==="cfo") target = document.querySelector(".card-cfo");
    if(role==="cto") target = document.querySelector(".card-cto");
    if(role==="md")  target = document.querySelector(".card-md");
    
    if(target){
        clearFocus();
        target.classList.add("zero-focus");
        target.scrollIntoView({ behavior:"smooth", block:"center" }); // center is better for visibility
        
        if(role==="cfo"){
            try{ if(window.openCfoModal) window.openCfoModal(); }catch(e){}
        }
    }
  }, { passive:true });
})();
</script>
<script>
/* ZERO_INDEX_MODULE_REDIRECT v1 */
(function(){
  function qs(k){
    try{ return new URLSearchParams(location.search).get(k); }
    catch(e){ return null; }
  }
  function go(){
    var module = String(qs("module")||"").toLowerCase();
    if(!module) return;
    var role = String(qs("role")||"").toLowerCase();
    var nocache = Date.now();

    if(module==="fabric"){
      var url = "fabric-dpp.html";
      var q = [];
      if(role) q.push("role="+encodeURIComponent(role));
      q.push("nocache="+nocache);
      location.replace(url + "?" + q.join("&"));
      return;
    }

    if(module==="fibre" || module==="fiber"){
      var url2 = "fibre-dpp.html";
      var q2 = [];
      if(role) q2.push("role="+encodeURIComponent(role));
      q2.push("nocache="+nocache);
      location.replace(url2 + "?" + q2.join("&"));
      return;
    }

    if(module==="yarn"){
      var url3 = "yarn-dpp.html";
      var q3 = [];
      if(role) q3.push("role="+encodeURIComponent(role));
      q3.push("nocache="+nocache);
      location.replace(url3 + "?" + q3.join("&"));
      return;
    }

    if(module==="energy"){
      var url4 = "energy-dpp.html";
      var q4 = [];
      if(role) q4.push("role="+encodeURIComponent(role)); // Energy might not have roles yet, but pass it anyway
      q4.push("nocache="+nocache);
      location.replace(url4 + "?" + q4.join("&"));
      return;
    }

    if(module==="chemicals" || module==="dye" || module==="chemical"){
      var url5 = "chemicals-dyes-management.dpp.html";
      var q5 = [];
      if(role) q5.push("role="+encodeURIComponent(role));
      q5.push("nocache="+nocache);
      location.replace(url5 + "?" + q5.join("&"));
      return;
    }

    if(module==="finishing"){
      var url6 = "finishing-dpp.html";
      var q6 = [];
      if(role) q6.push("role="+encodeURIComponent(role));
      q6.push("nocache="+nocache);
      location.replace(url6 + "?" + q6.join("&"));
      return;
    }
  }
  document.addEventListener("DOMContentLoaded", function(){
    // small delay: let page paint once (looks nicer)
    setTimeout(go, 80);
  });
})();
</script>
</body>
</html>